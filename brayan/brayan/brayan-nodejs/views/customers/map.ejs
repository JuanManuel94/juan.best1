<%- include('../resources/includes/head') %>

    <body>
        <div id="page-container" class="fade page-sidebar-fixed page-header-fixed">
            <%- include('../resources/includes/header') %>
                <%- include('../resources/includes/sidebar') %>
                    <div id="content" class="content">
                        <ol class="breadcrumb float-xl-right">
                            <li class="breadcrumb-item"><a href="/dashboard">Inicio</a></li>
                            <li class="breadcrumb-item">Clientes</li>
                            <li class="breadcrumb-item active">Mapa</li>
                        </ol>
                        <h1 class="page-header">Mapa de Clientes <small>ubicación geográfica</small></h1>
                        <div class="panel panel-inverse">
                            <div class="panel-heading">
                                <h4 class="panel-title">Mapa</h4>
                                <div class="panel-heading-btn">
                                    <select class="form-control form-control-sm" id="filterZone"
                                        style="width:200px;display:inline-block">
                                        <option value="">Todas las zonas</option>
                                    </select>
                                </div>
                            </div>
                            <div class="panel-body p-0">
                                <div id="map" style="height: 600px; width: 100%;"></div>
                            </div>
                        </div>
                    </div>
        </div>
        <%- include('../resources/includes/footer') %>
            <script>
                let map;
                const clients = [
                    { id: 1, name: 'Juan Pérez', lat: -12.0464, lng: -77.0428, status: 'active' },
                    { id: 2, name: 'María López', lat: -12.0564, lng: -77.0328, status: 'active' },
                    { id: 3, name: 'Carlos Ruiz', lat: -12.0364, lng: -77.0528, status: 'suspended' }
                ];
                function initMap() {
                    map = L.map('map').setView([-12.0464, -77.0428], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap'
                    }).addTo(map);
                    clients.forEach(c => {
                        const color = c.status === 'active' ? 'green' : 'red';
                        L.circleMarker([c.lat, c.lng], { radius: 8, fillColor: color, color: '#fff', weight: 2, fillOpacity: 0.8 })
                            .bindPopup(`<b>${c.name}</b><br>Estado: ${c.status}`)
                            .addTo(map);
                    });
                }
                $(document).ready(function () {
                    if (typeof L !== 'undefined') initMap();
                    else {
                        const link = document.createElement('link');
                        link.rel = 'stylesheet';
                        link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
                        document.head.appendChild(link);
                        const script = document.createElement('script');
                        script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
                        script.onload = initMap;
                        document.body.appendChild(script);
                    }
                });
            </script>